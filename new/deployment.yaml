apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
  labels:
    lra_chart: lra_kubernetes-0.10.7
    service: b-pms-v1-vaultmanagement
    serviceVersion: b-pms-v1-vaultmanagement-c318f2a5e
  name: b-pms-v1-vaultmanagement-c318f2a5e
spec:
  progressDeadlineSeconds: 1300
  replicas: 1
  revisionHistoryLimit: 0
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
    spec:
      containers:
        - env:
            - name: eae_rhomega_namespace
              value: es.lra
            - name: eae_monitoredresource
              value: b-pms-v1-VaultManagement
          envFrom:
            - configMapRef:
                name: b-pms-v1-vaultmanagement-c318f2a5e
          image: >-
            gl-lra-services-docker-local.registry.live.es.nextgen.igrupobbva/services/java/1-10-3/glo/b-pms-v1-vaultmanagement/c318f2a5e:9913bfca8
          imagePullPolicy: IfNotPresent
          lifecycle:
            preStop:
              exec:
                command:
                  - /bin/sh
                  - '-c'
                  - >-
                    curl -X POST localhost:15000/drain_listeners?inboundonly;
                    while [ $(netstat -plunt | grep tcp | grep -v envoy | grep
                    -v pilot-agent | wc -l | xargs) -ne 0 ]; do sleep 1; done
          livenessProbe:
            exec:
              command:
                - /lra/grpc_health
                - '-addr=0.0.0.0:50051'
                - '-connect-timeout'
                - 1s
                - '-rpc-timeout'
                - 3000ms
                - '-service'
                - liveness
            failureThreshold: 6
            periodSeconds: 300
            successThreshold: 1
            timeoutSeconds: 300
          name: b-pms-v1-vaultmanagement-c318f2a5e
          ports:
            - containerPort: 50051
              name: grpc
              protocol: TCP
            - containerPort: 4040
              name: metrics
              protocol: TCP
          readinessProbe:
            exec:
              command:
                - /lra/grpc_health
                - '-addr=0.0.0.0:50051'
                - '-connect-timeout'
                - 1s
                - '-rpc-timeout'
                - 3000ms
                - '-service'
                - readiness
            failureThreshold: 3
            periodSeconds: 300
            successThreshold: 1
            timeoutSeconds: 300
          resources:
            limits:
              cpu: 250m
              memory: 512M
            requests:
              cpu: 100m
              memory: 512M
          startupProbe:
            exec:
              command:
                - /lra/grpc_health
                - '-addr=0.0.0.0:50051'
                - '-connect-timeout'
                - 5s
                - '-rpc-timeout'
                - 12000ms
                - '-rpc-header'
                - lra-health-probe:startup
                - '-rpc-header'
                - x-rho-caller-id:K8s
                - '-rpc-header'
                - x-rho-caller-id2:Startup
                - '-rpc-header'
                - x-rho-caller-runtime:LRA
                - '-service'
                - startup
            failureThreshold: 3
            initialDelaySeconds: 20
            periodSeconds: 17
            successThreshold: 1
            timeoutSeconds: 17
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      serviceAccount: pms.vault
      serviceAccountName: pms.vault
      terminationGracePeriodSeconds: 30
